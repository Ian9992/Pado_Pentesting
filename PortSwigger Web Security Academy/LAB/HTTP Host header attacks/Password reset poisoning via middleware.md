# Password reset poisoning via middleware	
* This lab is vulnerable to password reset poisoning. The user carlos will carelessly click on any links in emails that he receives. To solve the lab, log in to Carlos's account. You can log in to your own account using the following credentials: `wiener:peter`.
	* Any emails sent to this account can be read via the email client on the exploit server.

### 1. Enumerate the web page's functionalities
* At the login panel, a "Forgot password?" funtionality is found.

![1](https://user-images.githubusercontent.com/53956303/156248220-9a4e21d5-4d21-4e89-bbee-9dbefbe887b6.png)
* When click the "Forgot password?", a panel to enter an username or email is found.
	* Use the provided username "wiener"

![image](https://user-images.githubusercontent.com/53956303/156255303-bcccce96-8a5e-4094-994b-ffebf7f3725d.png)
* As a result, the email client in the exploit server, a link containing `temp-forgot-password-token` is given.

![10](https://user-images.githubusercontent.com/53956303/156255417-82f4f6ca-e3b9-4079-b040-22692bbc16e5.png)

### 2. Test `X-Forwarded-Host` header
* Insert `X-Forwarded-Host: test.com`. the request still works!

![11](https://user-images.githubusercontent.com/53956303/156257237-39ef1cd2-2ff7-47ed-9633-1c10f4ae6b22.png)
### 3. Exploit using `X-Forwarder-Host` header
* Set to `X-Forwarded-Host` to exploit server and `ussername` to carlos to exploit.
	* As a result, when Carlos cick the link, the newly created `forgot-password-token` is given at the access log

![12](https://user-images.githubusercontent.com/53956303/156257490-3238fa66-9e6a-43b5-82c8-a0182a19fe98.png)

* Use the token to change Carlos's password.
	* As a result, from the `https://ac011f641f21e03bc1da242f001c00d2.web-security-academy.net/forgot-password?temp-forgot-password-token=aSrmSlvZeyuTvzyncuGTjCtZhSVyFVsz`, password reset panel for Carlos user is found.
		* Change the password to `test123`, then, login as Carlos.
* As a result, the lab is solved.

![13](https://user-images.githubusercontent.com/53956303/156258029-5d46fd8f-5045-4d88-9152-c118833c667c.png)
