# Web cache poisoning via ambiguous requests
* This lab is vulnerable to web cache poisoning due to discrepancies in how the cache and the back-end application handle ambiguous requests. An unsuspecting user regularly visits the site's home page.
	* To solve the lab, poison the cache so the home page executes `alert(docuemnt.cookie)` in the victim's browser.
	
### 1. Enumerate the home page
* This Host header is reflected in an absolute URL used to import a script from `/resources/js/tracking.js`

![24](https://user-images.githubusercontent.com/53956303/156266887-bb1a8930-fc42-4095-b475-f044f9a94dea.png)

### 2. Test the ambiguous request with another Host header and cache-buster
* Use `?cb=12345` as a cache-buster and insert another header `Host: Testging.com`. Then, sned the request until `X-Cache: hit` is given.

![25](https://user-images.githubusercontent.com/53956303/156267195-a4181323-68a9-41f7-a1cf-9a6c2786aad6.png)
* As a result, the second Host is used for the absolute URL used to import a script from `/resources/js/tracking.js`.

### 3. Create a payload using the provided exploit server
* Add this line to body
```javascript
alert(document.cookie)
```
* Change the File name to `/resources/js/tracking.js`
	* Then, store the exploit.

![26](https://user-images.githubusercontent.com/53956303/156267373-2b334889-1ca4-4367-bdbd-1d9f4020776e.png)
### 4. Modify the request to poison the cache of the home page.
* Remove the cache-buster and set to second Host header to the exploit server.
	* Then, send the request until `X-Cache: hit` is given.

![27](https://user-images.githubusercontent.com/53956303/156267495-5d66d78c-1865-426c-b45a-a0c7ceef03a5.png)
* As a result, the cache is poisoned. When a visitor visits the page, the script `alert(document.cookie)` will be executed.
	* After few minutes, the script is executed and the lab is solved.

![28](https://user-images.githubusercontent.com/53956303/156267665-7b61c80b-0f3f-4a08-9ac3-da76010e0971.png)
