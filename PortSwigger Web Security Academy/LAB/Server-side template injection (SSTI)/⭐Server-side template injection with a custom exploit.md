# Server-side template injection with a custom exploit
* This lab is vulnerable to server-side template injection. To solve the lab, create a custom exploit to delete the file `/.ssd/id_rsa` from Carlos's home directory.
	*  You can log in to your own account using the following credentials: `wiener:peter`

### 1. Enumerate the web page
* From the `/my-account`, an avatar upload function is found.

![35](https://user-images.githubusercontent.com/53956303/155433328-9b1314f9-ca74-4e61-91ef-41dd9dc86156.png)
* When an invalid file (not an image file) is uploaded, an error message is given.
	* this error message disclose a method `user.setAvatar`. It takes a file, and file type as arguments.
	 
![36](https://user-images.githubusercontent.com/53956303/155433428-ab2bd164-eb47-4c44-a6cf-66e7065cd46e.png)
### 2. Capture the request `POST /my-account/change-blog-post-author-display`
* This request is made when change the preferred name.

![37](https://user-images.githubusercontent.com/53956303/155435910-7d163bb3-f456-4b09-889d-3a5798a416fc.png)
* This request has a parameter `blog-post-author-display`. It has `user.nickname` as value.
	* It can be abused by using `user.setAvatar()` method.

### 3. Use `user.setAvatar()` method for arbitrary file disclosure
* Use the `user.setAvatar()` method to obtain the `/etc/passwd`
```java
blog-post-author-display=user.setAvatar('/etc/passwd','image/jpg')
```
![38](https://user-images.githubusercontent.com/53956303/155436925-1f2354d9-3bbd-4f17-9564-7dfcd8e251ce.png)
* then, get the value by requesting the `GET /avatar?avatar=wiener`
	* As a result, `/etc/passwd` is given.

![39](https://user-images.githubusercontent.com/53956303/155437057-5ae9bcdc-d68d-43a2-a12e-3ec42df1f04e.png)
### 4. Obtain the `/home/carlos/User.php`
* This file looks to manage the files, so obtain this file to enumerate the application.
```java
blog-post-author-display=user.setAvatar('/home/carlos/User.php','image/jpg')
```
* Then, requesting the `GET /avatar?avatar=wiener` to get the source code.
	* From the source code, a method `gdprDelete()`, which deletes the user's avatar is found. It might be able to use to delete the target file
---cont

