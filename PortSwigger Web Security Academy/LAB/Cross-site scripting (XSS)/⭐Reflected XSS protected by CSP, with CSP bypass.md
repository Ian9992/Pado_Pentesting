# Refelcted XSS protected by CSP, with CSP bypass
* This lab uses CSP and contains a reflected XSS vulnerability
	* To solve the lab, perform a XSS attack that bypasses the CSP and calls the _alert_ function.
	* Please note that the intended solution to this lab is only possible in **Chrome**.

### 1. Enter the following into the search box
```html
<img src=1 onerror=alert(1)>
```
* Observe that the payload is reflected, but the CSP prevents the script from executing


![81](https://user-images.githubusercontent.com/53956303/153504758-6e896602-ff87-4750-a40c-2252e1e692a8.png)
### 2. In Burp proxy, Observe the response
![82](https://user-images.githubusercontent.com/53956303/153503565-1fb99e30-3582-47ac-bbf5-3b295c33b2ef.png)
* the response contains a `Content-Security-Policy` header, and the `report-uri` directive contains a parameter called `token` 
	* Because you can control the `token` parameter, you can inject your own CSP directives into the policy

### 3. Visit the following URL
* Use this payload `<script>alert(1)</script>&token=;script-src-elem 'unsafe-inline'`
```http
https://acf71f151fa3c152c0ef330900e800dc.web-security-academy.net/?search=<script>alert(1)</script>&token=;script-src-elem 'unsafe-inline'
```
* The injection uses the `script-src-elem` directives in CSP.
	* This directive allows you to target just `script` elements. Using this directive, you can overwrite existing `script-src` rules enabling you to inject `unsafe-inline`, which allows you to use inline scripts.

* As a result, an alert is popped up.

![83](https://user-images.githubusercontent.com/53956303/153504598-298c9f9a-1ff0-4f5d-b8ae-5c11a7ad6539.png)
* From the response, the exploit is successfully injected

![85](https://user-images.githubusercontent.com/53956303/153505266-cd0bb2b9-68e6-4181-b303-8f54a729cee2.png)

* The lab is solved.

![84](https://user-images.githubusercontent.com/53956303/153504669-d48e93a0-8611-4b0b-a01b-72edc50dd516.png)
