# Exploiting Java deserialization with Apache Commons
* This lab uses a serialization-based session mechanism and loads the Apache Commons Collections library. Although you do not have source code access, you can still exploit the lab using pre-built gadget chains.
	* To solve the lab, use a thrid-party tool to generate a malicious serialized object containing a remote code execution payload. Then, pass the obejct into the website to delete the `morale.txt` file from Carlos's home directory.
	* You can log in to your own account using the following credentials: `wiener:peter`

### 1. Enumerate the 
* Login as "wiener" and capture a cookie for enumeration.

![20](https://user-images.githubusercontent.com/53956303/154772545-83a82767-e285-4955-b497-cb83998fcdc3.png)
* The string in a cookie starts with `ro0` which is the pattern of a Java Serialization.

### 2. Generate a malicious base 64 encoded payload using `ysoserial` and replace the cookie with the generated payload
```bash
java -jar /opt/ysoserial.jar CommonsCollections4 'rm /home/carlos/morale.txt' | base64
```
![21_exploit](https://user-images.githubusercontent.com/53956303/154772869-425d3b59-cad2-4085-9f18-3ec0935e1e12.jpg)

* Paste the result at the session cookie, URL encode the exploit and send the request.

![21](https://user-images.githubusercontent.com/53956303/154772831-e2157aec-8cd9-4366-9126-b6f459b768db.png)
* The response gives 500 Internal Server error, but the target file is successfully deleted from the system.
	* The lab is solved.

![23](https://user-images.githubusercontent.com/53956303/154773132-940e54bc-5bda-41e7-a05f-3f6bee7e6754.png)
