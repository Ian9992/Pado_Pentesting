# Arbitrary object injection in PHP
* This lab uses a serialization-based session mechanism and is vulnerable to arbitrary object injection as a result. To solve the lab, create and inject a malicious serialized object to delete the `morale.txt` file from Carlos's home directory. You will need to obtain source code access to solve the lab.
	* You can log in to your own account using the following credentials: `wiener:peter`

#### Hint: You can sometimes read source code by appending a tilde (~) to a filename to retrieve an editor-generated backup file.
### 1. Login and enumerate the website
* From the request, a session cookie that contains serialized PHP is found.

![15](https://user-images.githubusercontent.com/53956303/154767322-67ca5294-fd25-49d3-8475-d4f27fa843f1.png)
### 2. Enumerate the server file
* Using the sitemap function on the Burp, a PHP file `CustomTemplate.php` is found

![16](https://user-images.githubusercontent.com/53956303/154767531-3bfce681-3694-4992-b79b-2559d6e8feba.png)
* Send this to Burp repeater to read the source code.
### 3. Getting a source code
* Sometimes a file's source code is revealed using a tilde (~)
	* Add ~ after the file name
* As a result, the source file is given.
![17](https://user-images.githubusercontent.com/53956303/154767851-4b758348-8bb6-4e3e-b048-2c29dd53b00a.png)
* From the source code, `CustomTemplate` class contains the `__destruct()` magic method.
	* This will invoke the `unlike()` method on the `lock_file_path` attribute, which will delete the file on this path.

### 4. Modify the PHP serialized session cookie
* Modify the cookie from `O:4:"User":2:{s:8:"username";s:6:"wiener";s:12:"access_token";s:32:"c9udxiy0setyfz27fex2z617k0pd0km3";}` to
	* `O:14:"CustomTemplate":1:{s:14:"lock_file_path";s:23:"/home/carlos/morale.txt";}`
* Use the Burp Inspector and click "Apply changes", then send the request.

![18](https://user-images.githubusercontent.com/53956303/154768701-9b5b13a5-6168-40c0-baa8-2b19869ebcde.png)
* When the request is sent, the `__destruct()` magic method is automatically invoked and will delete Carlos's file.
	* As a result, the response gives 500 Internal Server Error. However, the file is successfully deleted and the lab is solved.

![19](https://user-images.githubusercontent.com/53956303/154768951-3a060e88-4cee-4f0e-bf94-6a2ab161ecbe.png)
