# DOM XSS using web messages and a JavaScript URL
* This lav demonstrate a DOM-based redirection vulnerability that is triggered by web messaging. To solve this lab, construct a HTML page on the exploit server that exploits this vulnerability and calls the `print()` function.

### 1. Enumerate the web page
* from the page source of home page, `addEventListener()` function for message is found

![7](https://user-images.githubusercontent.com/53956303/154375301-1fab7e1f-3b3d-4f32-b171-7f32918f588c.png)
* It contains JavaScript that contains a flawed `indexOf()` check that looks for the strings "http:" or "https:" anywhere within the web message.
* It also contains a sink `location.href`

### 2. Make a exploit in the provided exploit server
```html
<iframe src="https://acb41f3d1fe875e2c0ac9add0038002e.web-security-academy.net/" onload="this.contentWindow.postMessage('javascript:print()//http:','*')">
```
![8](https://user-images.githubusercontent.com/53956303/154375930-6ae2f674-5730-4cf0-8c4d-c6ed68dfbeca.png)
* This script sends a web message containing an arbitrary JavaScript payload, alogn with the string `http:`. The second argument specifies that any `targetOrigin` is allowed for the web message.
* When the `iframe` loads, the `postMessage()` method sends the JavaScript payload to the main page. The event listener sposts the "http:" string and proceeds to send the payload to the `location.href` sink where `print()` function is called

* Store the exploit and deliver to the victim.
  * As a result, the lab is solved.

![9](https://user-images.githubusercontent.com/53956303/154375965-98e2aed6-5faa-4aee-9e80-53c4c756ba14.png)

