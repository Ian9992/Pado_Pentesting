# Clobbering DOM attributes to bypass HTML filters
* This lab uses the HTMLJanitor library, which is vulnerable to DOM cloberring. To solve the lab, construct a vector that bypasses the filter and uses DOM clobbering to inject a vector that calls the `print()` function. You may need to use the exploit server in order to make your vector auto-execute in the victim's browser.

### 1. Enumerate the web page using a browser's inspector
* From the inspector "htmlJanitor.js" library which is vulnerable to DOM clobbering is found

![20](https://user-images.githubusercontent.com/53956303/154574140-748e8b5c-4558-4666-bac0-dd002fc16a57.png)
### 2. Inject a malicious HTML at the comment section
```html
<form id=x tabindex=0 onfocus=print()><input id=attributes>
```
![21](https://user-images.githubusercontent.com/53956303/154574414-76e7a07b-f64d-4c9a-a081-c34dd1092ad7.png)
### 3. Inject a malicious _iframe_ using the provided Exploit server
```html
<iframe src=https://acf31fc41ec9a206c0623b54009f003c.web-security-academy.net/post?postId=4 onload="setTimeout(()=>this.src=this.src+'#x',500)">
```
![22](https://user-images.githubusercontent.com/53956303/154574689-6046704a-99c7-419b-882b-ecc474ac648e.png)
* Store and deliver the exploit to victim

* The library uses the `attributes` property to filter HTMl attributes. However, it is still possible to clobber the `attributes` property itself, causing the length to be undefined.
	* This allows us to inject any attributes we want into the `form` element. In this case, we use the `onfocus` attribute to smuggle the `print()` function
* When the `iframe` is loaded, after a 500ms delay, it adds the `#x` fragment to the end of the page URL. The delay is necessary to make sure that the comment containing the injection is loaded before the JavaScript is executed. This causes the browser to focus on the element with the ID "x", which is the form we created inside the comment. The `onfocus` event handler then calls the `print()` function.
