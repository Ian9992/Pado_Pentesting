# 2FA broken logic
* This lab's two-factor authentication is vulnerable due to its flawed logic. To solve the lab, access Carlos's account page
	* Your credentials: `wiener:peter`
	* Victim's usernmae: `carlos`
* You also have access to the email server to recieve the 2FA code.
### 1. Enumerate the website by using Burp Suite
* Capture the request when log in using `wiener`'s credentials.
	* From the `GET /login2` where require the 4-digit security code, has a `verify` parameter on the cookie.

![56](https://user-images.githubusercontent.com/53956303/161643270-cbe1f39b-685c-468e-95ca-fc6e732de91d.png)
* From the email server, a 4-digit code for login is given.

![57](https://user-images.githubusercontent.com/53956303/161643407-a11e5ea7-bdea-48fe-8923-35eea4c9119a.png)
* When enter the 4-digit, the `POSt /login2` request is captured. It also contains `verity` parameter on the cookie.

![58](https://user-images.githubusercontent.com/53956303/161643518-f964400f-48c6-4114-9938-dedbf6a607b2.png)
### 2. Modify the request when the server generate the digit to send to a requested user
* Try to log in with `wiener`'s credentials and capture and modify the `GET /login2` request's `verify` parameter to get the 4-digit code for the victim user.
	* At the `GET /login2`, modify the value of `verify` cookie from wiener to carlos.

![59](https://user-images.githubusercontent.com/53956303/161644307-cfdfd62f-06c9-4ff1-a065-7821c8ffe922.png)
* It will generate a 4-digit code for Carlos

### 3. Use the Intruder to brute force the 2FA pin
* Use Intruder to brute force 4-digit code in `POST /login2`.

![61](https://user-images.githubusercontent.com/53956303/161645725-84d87d6c-7afe-4b1e-bfc5-fa58c1bc3b5d.png)
* Use a [four-digit dictionary](https://raw.githubusercontent.com/danielmiessler/SecLists/master/Fuzzing/4-digits-0000-9999.txt) to brute force.

![62](https://user-images.githubusercontent.com/53956303/161645779-55268930-84a4-4ea6-98fe-c1bbdf6db534.png)
* As a result, a request got a 302 response code. It means the right pin is found.
	* Open a response on the browser. As a result, the lab is solved.

