# Brute-forcing a stay-logged-in cookie
* This lab allows users to stay logged in even after they close their browser session. The cookie used to provide this functionality is vulnerable to brute-forcing.
	* To solve the lab, brute-force Carlos's cookie to gain access to this "My account" page.
	* Your credentials: `wiener:peter`
	* Victim's username: `carlos`

### 1. Capture the request and enumerate the request/response
* Log in as `wiener` with checking the "Stay logged in" functionality.

![40](https://user-images.githubusercontent.com/53956303/160729317-7a066c1b-2ba2-4778-b754-8ec9fae4e000.png)
* Capture the request when log in and enumerate the request and response.

![41](https://user-images.githubusercontent.com/53956303/160729478-34132306-73fc-4753-8564-f35d8a419da5.png)
* From the request, a parameter "stay-logged-in" is set to on

![42](https://user-images.githubusercontent.com/53956303/160729529-877965b7-85a6-43d0-a669-1608d425cb19.png)
* From the response, a cookie `stay-logged-in` is found. It contains a base 64 encoded like string.
	* Using the Burp inspector to decode it.

![43](https://user-images.githubusercontent.com/53956303/160729684-278d1b96-5f41-4dc0-9fa3-e7770433746b.png)
* It is a base64 encoded string. However, the string after the username might be hashed string.
	* Use the [crackstation](crackstation.net) to identify the hashed string. From the result, the string after the username is a md5 hashed password!

![44](https://user-images.githubusercontent.com/53956303/160729873-5d82528c-dd70-4b79-a379-85ba78802185.png)
### 2. Log out and capture the request again of `GET /my-account` processing the string using Intruder
* this request contains "Stay-logged-in" cookie. Set the payload position here.

![45](https://user-images.githubusercontent.com/53956303/160730095-95d09f68-615d-4061-8afd-0396b231940b.png)
* Add the "peter" as the single payload, and under "Payload processing", add the following rules

![46](https://user-images.githubusercontent.com/53956303/160730271-dffb62ef-e8d3-4d55-8716-7617969cc06d.png)
### 3. Set the Grep-match
* Since "Update email" button is found on the `/my-account`, use it to determine if the attack is successful.

![47](https://user-images.githubusercontent.com/53956303/160730361-3a0e51d4-8edf-436e-b16c-2b2324c75f38.png)
* Then, start attack. As a result, the payload was successfully load the Wiener's account page. This confirms that the payload processing rules work as expected.

### 4. Modify the Intruder to brute force password for Carlos's account
1. Add the password list to the payload.
2. Change from `Add prefix: wiener:` to `Add prefix: Carlos:`
	* Then, start the attack. From the result, only one payload has the "Update email" string in the response. It means that the payload is valid.

![48](https://user-images.githubusercontent.com/53956303/160732058-dba55b4f-2f0b-46ee-b480-2177d6478177.png)
* Decode the string to obtain the valid password for Carlos's account.

![49](https://user-images.githubusercontent.com/53956303/160732229-adf8e849-0559-4228-85d6-bdd1edde9f7a.png)
* Log in using the obtained credentials for "Carlos". As a result, the lab is solved.

![50](https://user-images.githubusercontent.com/53956303/160732349-48b27b96-27b7-48c7-b333-89727c6fd581.png)
