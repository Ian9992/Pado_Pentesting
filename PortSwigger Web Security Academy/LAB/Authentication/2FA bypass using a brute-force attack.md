# 2FA bypass using a brute-force attack
* This lab's two-factor authentication is vulnerable to brute-forcing. You have already obtained a valid username and password, but do not have access to the user's 2FA verification code. To solve the lab, brute-force the 2FA code and access Carlos's account page.
	* Victim's credentials `carlos:montoya`
### 1. Capture the request when log in using the vicim's credentials
* When log in using the crednetial, a page that requests a 4-digit security code `/login2` is found.

![72](https://user-images.githubusercontent.com/53956303/161649899-849bbc13-6dac-4f47-8da7-bc86c63aeb16.png)
* However, when enter 2 incorrect pin codes, the user will be automatically logged out.
	* Therefore, a Burp's session handling features must be used to log back in automatically.
* In Burp, go to `Project options > Session`. In the `Session Handling Rules` panel, click `Add`. The `Session handling rule editor` dialog opens.
	* In the dialog, go to the `Scope` tab, Under `URL Scope`, select the option `include all URLs`

![73](https://user-images.githubusercontent.com/53956303/161650342-4b37e53a-b784-46ca-b5b0-bdeb5b7bc7c6.png)
* Go back to `details` tab and under `Rule Actions`, click `Add > Run a macro`

![74](https://user-images.githubusercontent.com/53956303/161650476-11cec2d9-8ab1-4bb7-a475-0e795f32886e.png)
* Under `Select macro` click `Add` to open the `Macro Recorder`. Select the following 3 requests:
	* `GET /login`
	* `POST /login`
	* `GET /login2`

![75](https://user-images.githubusercontent.com/53956303/161650619-58ec0554-941d-4e78-9601-d86cb397ff38.png)
* Then, click `OK`. The `Macro Editor` dialog opens.
### 2. Exploit
* send the `POST /login2` request to Burp Intruder, and add a position to the `mfa-code` parameter

![76](https://user-images.githubusercontent.com/53956303/161652312-e0998d15-11a4-415e-ac22-f1527e04d1eb.png)
* On the payload tab, select the `Numbers` payload type. Enter the range 0-9999 and set the step to 1. Set the min/max integer digits to 4 and max fraction digits to 0.
	* This will create a payload for every possible 4-digit integer.

![77](https://user-images.githubusercontent.com/53956303/161652545-1af32199-6f82-4bec-af61-e80474f125c1.png)
* Go to `Resource pool` tab and add teh attack to a resource pool with the `Maximum concurrent requests` set to 1.

![78](https://user-images.githubusercontent.com/53956303/161652654-ef5e3ea8-a308-417e-9f31-c30152467f01.png)
* Then, start the attack. From the result, only one request got 302 response. It means that the right security code is found.
	* Right-click to `show response in browser`. Then, enter the `My account` tab. As a result, the lab is solved.
