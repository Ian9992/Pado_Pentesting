# Web cache poisoning with multiple headers
* This lab contains a web cache poisoning vulnerability that is only exploitable when you use multiple headers to craft a malicious request. A user visits the home page roughly once a minute.
	* To solve the lab, poison the cache with a response that executes `alert(document.cookie)` in the visitor's browser.
	* The lab supports both `X-Forwarded-Host` and `X-Forwarded-scheme`
### 1. Capture the request from the home page for enumeration
![12](https://user-images.githubusercontent.com/53956303/155631179-989c5480-686f-4f1a-ba79-dd8f3a266965.png)
* The request generate `/resources/js/tracking.js`

![13](https://user-images.githubusercontent.com/53956303/155812099-1837777c-9c0c-4b91-870d-388e30102f92.png)
### 2. Add a cache-buster query parameter and _X-Forwarded-Host_ header on the request
* use `?cb=12345` as a cache-buster query paramter and `X-Forwarded-Host: test.com` as the header

![14](https://user-images.githubusercontent.com/53956303/155812768-8420dce1-152b-41bc-b5e6-e3870ce91683.png)
* Nothing special changed on the request.
### 3. Replace _X-Forwarded-Host_ with _X-Forwarded-Scheme_
* Use `X-Forwarded-Scheme: nonhttps` as a header.
	* As a result, a 302 found response is given. The _Location_ header on the response points the requted address.

![15](https://user-images.githubusercontent.com/53956303/155812995-9b184da9-0bab-4d76-a3f2-1abf45d06371.png)
### 4. Use _X-Forwarded-Host_ and _X-Forwarded-Scheme_ at the same time
* Add `X-Forwarded-Host: test.com` additionally
	* As a result, the response gives a 302 status code and the _Location_ header points "test.com"

![16](https://user-images.githubusercontent.com/53956303/155813254-c7a40d64-561f-40d3-b521-d60ad4c7928d.png)
### 5. Make an exploit on the provided exploit server
![17](https://user-images.githubusercontent.com/53956303/155813357-0a7b5348-61bc-4161-916e-b2fc6d3ef8b7.png)
### 6. Change _X-Forwared-Host_ to the lab address
* Also remove the cache-buster query parameter.
	* Then, send the request until the _X-Cache_ gives "hit"

![18](https://user-images.githubusercontent.com/53956303/155813924-798be58b-97c3-411e-ae3f-3dd58cbfe781.png)
* Wait until the victim visit the site. As a result, the lab is solved.

![19](https://user-images.githubusercontent.com/53956303/155813995-32bc9ade-d271-41e8-9126-aa83727c97c7.png)
