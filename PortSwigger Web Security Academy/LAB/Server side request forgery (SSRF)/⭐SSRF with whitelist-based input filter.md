# SSRF with whitelist-based input filter
* This lab has a stock check feature which fetches data from an internal system. 
	* To solve this lab, change the stock check URL to access the admin interface at `http://localhost/admin` and delete the user _carlos_
	* The developer has deployed an anti-SSRF defense you will need to bypass.

### 1. Capture the _POST /product/stcok_ request

![16](https://user-images.githubusercontent.com/53956303/152611087-6ff5b4ce-153d-4527-a39c-3d11fb529830.png)
* Then, send it to repeater to modify
### 2. Test to access `http://localhost/admin`
* Modify the _stcokApi_ to `http://localhost/admin` and send the request.

![17](https://user-images.githubusercontent.com/53956303/152611215-49f9af2b-a626-4b55-ae48-471068c0892e.png)
* From the result, the response returns an error message.
	* `External stock check host must be stock.weliketoshop.net`. It means that "stock.weliketoshop.net" must be contained as the value of _stockApi_ parameter.

### 3. Try to connect the localhost using SSRF
* The URL parser identifies as a URL before the # sign, elements after the # sign, and path after / sign.
```http
stockApi=http://localhost#@stock.weliketoshop.net
```
* However, it gives "External stock check host must be stock.weliketoshop.net" error again.

![18](https://user-images.githubusercontent.com/53956303/152613105-0f391f57-4dd6-4209-95ff-26d3660193d8.png)
* URL encode the # sign and send the request again
	* It returns the same error

![19](https://user-images.githubusercontent.com/53956303/152613182-d02a7ef7-9b82-4da3-85d7-cfaa1c3418fe.png)
* Double-URL encode the # sign and send the request again
	* The homepage with the admin panel is revealed!

![20](https://user-images.githubusercontent.com/53956303/152613286-21f98d84-2b96-45e2-af13-2c2ad476c2a3.png)
### 4. Enumerate `/admin`
* Modify the request to enumerate the admin panel
	* The URL parser identifies as a URL before the # sign, elements after the # sign, and path after / sign.
```http
http://localhost%2523@stock.weliketoshop.net/admin
```
* As a result, a function to delete _carlos_ is found

![21](https://user-images.githubusercontent.com/53956303/152614161-ac5b6228-9af4-41df-b35a-1a9c60d9203b.png)
### 5. Delete _carlos_ user
* Modify the request to delete the user
```http
http://localhost%2523@stock.weliketoshop.net/admin/delete?username=carlos
```
* As a result, the _carlos_ user is deleted and the lab is solved.

![22](https://user-images.githubusercontent.com/53956303/152614284-fe2b3b16-98d6-4d50-9336-7bed7531af3c.png)
