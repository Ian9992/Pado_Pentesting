# CSRF wher token is tied to non-session cookie
* This lab's email change functionality is vulenrable to CSRF. It uses tokens to try to prevent CSRF attacks, but they aren't fully integrated into the site's session handling system.
	* To solve the lab, use your exploit server to host an HTML page that uses a CSRF attack to change the viewer's email address.
	* You have two accounts on the application that you can use to help design your attack. The credentials are as follows. `wiener:peter` and `carlos:montoya`

### 1. Capture the Wiener's request using Burp's browser
![15](https://user-images.githubusercontent.com/53956303/153682790-067d4e1d-896a-4afb-b87c-e8efa0d90115.png)
* Note the `csrfKey` and `csrf` and drop the request

|parameter|value|
|----|----|
|csrfKey |DgiL54rUPmCtCCnykILNIXHe9K0FC8zV|
|CSRF| 4KkcvhfVDahLWL8XXPmLe5garwzOe14U

### 2. Capture the Carlos's request using Firefox
* Send the reqeust to repeater and replace the `csrfKey` and `csrf` with _wiener's_, and send the request
	* As a result, 302 response is given and the carlos's email is successfully changed.

![image](https://user-images.githubusercontent.com/53956303/153683075-bdd69545-bdfb-48e9-be35-27aa5ab779b3.png)
* It means that the CSRF token is tied to `csrfKey` cookie

### 3. Make a malicious HTML using the provided Exploit server
* Since the CSRF token is single-use, issue a new "wiener's" CSRF token to use.


